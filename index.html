<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivia League - The Dozen Style</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:wght@400;600;700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-purple: #8B31C9;
            --primary-pink: #E91E8C;
            --primary-green: #00FF41;
            --dark-bg: #0A0A0F;
            --card-bg: #1A1A24;
            --accent-yellow: #FFD700;
            --text-light: #FFFFFF;
            --text-dim: #A0A0B0;
        }

        body {
            font-family: 'Barlow Condensed', sans-serif;
            background: linear-gradient(135deg, #0A0A0F 0%, #1A1A24 50%, #0A0A0F 100%);
            color: var(--text-light);
            overflow-x: hidden;
            min-height: 100vh;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            opacity: 0.3;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 4rem;
            font-weight: 900;
            letter-spacing: 4px;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-pink), var(--accent-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(139, 49, 201, 0.5);
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1.2rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        /* Setup Screen */
        .setup-screen {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            margin: 0 auto;
            border: 2px solid var(--primary-purple);
            box-shadow: 0 20px 60px rgba(139, 49, 201, 0.3);
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .setup-screen h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: var(--primary-green);
            text-align: center;
            letter-spacing: 2px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 15px;
            background: var(--dark-bg);
            border: 2px solid var(--primary-purple);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1.1rem;
            font-family: 'Barlow Condensed', sans-serif;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--primary-pink);
            box-shadow: 0 0 20px rgba(233, 30, 140, 0.4);
        }

        select {
            cursor: pointer;
        }

        .role-select {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .role-btn {
            flex: 1;
            padding: 15px;
            background: var(--dark-bg);
            border: 2px solid var(--primary-purple);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .role-btn:hover {
            background: var(--primary-purple);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(139, 49, 201, 0.4);
        }

        .role-btn.active {
            background: var(--primary-pink);
            border-color: var(--primary-pink);
            box-shadow: 0 0 20px rgba(233, 30, 140, 0.6);
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .category-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--dark-bg);
            border: 2px solid var(--primary-purple);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-checkbox:hover {
            border-color: var(--primary-pink);
        }

        .category-checkbox.selected {
            background: var(--primary-purple);
            border-color: var(--primary-green);
        }

        .category-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .category-checkbox label {
            margin: 0;
            font-size: 1rem;
            cursor: pointer;
            text-transform: none;
            letter-spacing: normal;
        }

        .btn-primary {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-pink));
            border: none;
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1.3rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            font-family: 'Bebas Neue', sans-serif;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(233, 30, 140, 0.5);
        }

        .btn-primary:active {
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .join-info {
            padding: 20px;
            background: var(--dark-bg);
            border-radius: 10px;
            margin-top: 25px;
            border: 3px solid var(--primary-green);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 65, 0.3); }
            50% { box-shadow: 0 0 30px rgba(0, 255, 65, 0.6); }
        }

        .join-info h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            color: var(--primary-green);
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        .join-code-display {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: var(--accent-yellow);
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 10px;
            border: 2px solid var(--accent-yellow);
            letter-spacing: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .join-code-display:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .share-link {
            font-family: 'Inter', monospace;
            font-size: 0.9rem;
            color: var(--text-light);
            word-break: break-all;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid var(--primary-purple);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .share-link:hover {
            border-color: var(--primary-pink);
            box-shadow: 0 0 15px rgba(233, 30, 140, 0.4);
        }

        .copy-hint {
            font-size: 0.9rem;
            color: var(--text-dim);
            text-align: center;
            margin-top: 10px;
        }

        .player-count {
            text-align: center;
            margin-top: 15px;
            font-size: 1.3rem;
            color: var(--accent-yellow);
            font-weight: 600;
        }

        /* Lobby Screen */
        .lobby-screen {
            display: none;
        }

        .lobby-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            border: 2px solid var(--accent-yellow);
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.3);
        }

        .lobby-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .lobby-header h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: var(--accent-yellow);
            letter-spacing: 3px;
            margin-bottom: 10px;
        }

        .lobby-teams {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .team-lobby {
            background: var(--dark-bg);
            border-radius: 15px;
            padding: 25px;
            border: 3px solid var(--primary-pink);
        }

        .team-lobby.team-right {
            border-color: var(--primary-green);
        }

        .team-lobby h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 2px;
        }

        .team-lobby.team-left h3 {
            color: var(--primary-pink);
        }

        .team-lobby.team-right h3 {
            color: var(--primary-green);
        }

        .player-slot {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 2px solid var(--primary-purple);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .player-slot.filled {
            border-color: var(--primary-green);
            background: linear-gradient(135deg, var(--card-bg), rgba(0, 255, 65, 0.1));
        }

        .player-slot.empty {
            opacity: 0.5;
            border-style: dashed;
        }

        .player-name-lobby {
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .move-btn {
            padding: 8px 15px;
            background: var(--primary-purple);
            border: none;
            border-radius: 6px;
            color: var(--text-light);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .move-btn:hover {
            background: var(--primary-pink);
            transform: translateY(-2px);
        }

        .unassigned-players {
            background: var(--dark-bg);
            border-radius: 15px;
            padding: 25px;
            border: 3px dashed var(--text-dim);
            margin-bottom: 30px;
        }

        .unassigned-players h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--text-dim);
            text-align: center;
            letter-spacing: 2px;
        }

        /* Game Screen */
        .game-screen {
            display: none;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .team-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .team-header {
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-pink));
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 2px;
            box-shadow: 0 5px 20px rgba(139, 49, 201, 0.4);
        }

        .team-header.team-left {
            background: linear-gradient(135deg, var(--primary-pink), #FF1493);
        }

        .team-header.team-right {
            background: linear-gradient(135deg, var(--primary-green), #00CC33);
        }

        .video-container {
            position: relative;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid var(--primary-purple);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            aspect-ratio: 4/3;
        }

        .video-container.host-video {
            border-color: var(--accent-yellow);
            aspect-ratio: 16/9;
        }

        .video-container.team-left {
            border-color: var(--primary-pink);
        }

        .video-container.team-right {
            border-color: var(--primary-green);
        }

        .video-container.empty {
            background: repeating-linear-gradient(
                45deg,
                var(--card-bg),
                var(--card-bg) 10px,
                var(--dark-bg) 10px,
                var(--dark-bg) 20px
            );
            opacity: 0.5;
        }

        .empty-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.9rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .player-name {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.8);
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .center-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Question Board */
        .question-board {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            border: 3px solid var(--primary-green);
            box-shadow: 0 20px 60px rgba(0, 255, 65, 0.2);
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .category-banner {
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-pink));
            padding: 15px 40px;
            border-radius: 10px;
            margin-bottom: 30px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            box-shadow: 0 5px 20px rgba(233, 30, 140, 0.4);
            max-width: 100%;
            text-align: center;
        }

        .question-text {
            font-size: 1.8rem;
            text-align: center;
            line-height: 1.4;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .timer {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 4rem;
            color: var(--accent-yellow);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Host Controls */
        .host-controls {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid var(--accent-yellow);
            margin-top: 20px;
        }

        .host-controls h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--accent-yellow);
            letter-spacing: 2px;
        }

        .control-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .btn-secondary {
            padding: 12px 25px;
            background: var(--primary-purple);
            border: none;
            border-radius: 8px;
            color: var(--text-light);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-secondary:hover {
            background: var(--primary-pink);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 30, 140, 0.4);
        }

        .btn-success {
            background: var(--primary-green);
            color: var(--dark-bg);
        }

        .btn-success:hover {
            background: #00CC33;
        }

        textarea {
            width: 100%;
            padding: 15px;
            background: var(--dark-bg);
            border: 2px solid var(--primary-purple);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1rem;
            font-family: 'Barlow Condensed', sans-serif;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 15px;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-pink);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 1400px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
            
            .lobby-teams {
                grid-template-columns: 1fr;
            }

            .logo {
                font-size: 3rem;
            }

            .question-text {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 2.5rem;
            }

            .question-text {
                font-size: 1.3rem;
            }

            .setup-screen, .lobby-container {
                padding: 25px;
            }

            .category-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    
    <div class="container">
        <div class="header">
            <h1 class="logo">TRIVIA LEAGUE</h1>
            <p class="tagline">Powered by Your Brain</p>
        </div>

        <!-- Setup Screen -->
        <div class="setup-screen" id="setupScreen">
            <h2 id="setupTitle">Join the Game</h2>
            
            <div id="roleSelection">
                <div class="input-group">
                    <label>Select Role</label>
                    <div class="role-select">
                        <button class="role-btn active" id="hostBtn">Host</button>
                        <button class="role-btn" id="playerBtn">Player</button>
                    </div>
                </div>
            </div>

            <!-- Host Setup -->
            <div id="hostSetup">
                <div class="input-group">
                    <label>Your Name (This becomes the join code)</label>
                    <input type="text" id="hostName" placeholder="e.g., Mike">
                </div>

                <div class="input-group">
                    <label>Team 1 Name</label>
                    <input type="text" id="team1Name" placeholder="e.g., The Champions" value="Team 1">
                </div>

                <div class="input-group">
                    <label>Team 2 Name</label>
                    <input type="text" id="team2Name" placeholder="e.g., The Challengers" value="Team 2">
                </div>

                <div class="input-group">
                    <label>Number of Questions</label>
                    <input type="number" id="numQuestions" min="5" max="50" value="20">
                </div>

                <div class="input-group">
                    <label>Select Categories</label>
                    <div class="category-grid" id="categoryGrid">
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>NBA</label>
                        </div>
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>NFL</label>
                        </div>
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>MLB</label>
                        </div>
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>College Football</label>
                        </div>
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>History</label>
                        </div>
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>Geography</label>
                        </div>
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>Celebrity Mashup</label>
                        </div>
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>Music</label>
                        </div>
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>Movies & TV</label>
                        </div>
                        <div class="category-checkbox selected" onclick="toggleCategory(this)">
                            <input type="checkbox" checked>
                            <label>General Sports</label>
                        </div>
                    </div>
                </div>

                <button class="btn-primary" id="createGameBtn">Create Game</button>

                <div class="join-info" id="hostJoinInfo" style="display: none;">
                    <h3>ðŸŽ® GAME CREATED!</h3>
                    <p style="text-align: center; margin-bottom: 15px;">Share this join code with players:</p>
                    <div class="join-code-display" id="joinCodeDisplay" onclick="copyJoinCode()">MIKE</div>
                    <p style="text-align: center; margin: 15px 0;">OR share this link:</p>
                    <div class="share-link" id="shareLinkDisplay" onclick="copyShareLink()">Click to copy link</div>
                    <div class="copy-hint">ðŸ“‹ Click to copy</div>
                    <div class="player-count" id="hostPlayerCount">Players Connected: 0/6</div>
                    <button class="btn-primary" id="goToLobbyBtn" style="margin-top: 20px;">GO TO LOBBY</button>
                </div>
            </div>

            <!-- Player Join -->
            <div id="playerJoin" style="display: none;">
                <div class="input-group">
                    <label>Your Name</label>
                    <input type="text" id="playerName" placeholder="Enter your name">
                </div>

                <div class="input-group">
                    <label>Host's Name (Join Code)</label>
                    <input type="text" id="hostJoinCode" placeholder="e.g., Mike">
                </div>

                <button class="btn-primary" id="joinGameBtn">Join Game</button>
            </div>
        </div>

        <!-- Lobby Screen -->
        <div class="lobby-screen" id="lobbyScreen">
            <div class="lobby-container">
                <div class="lobby-header">
                    <h2>GAME LOBBY</h2>
                    <p style="font-size: 1.2rem; color: var(--text-dim);">Assign players to teams</p>
                </div>

                <div class="unassigned-players" id="unassignedSection">
                    <h3>Unassigned Players</h3>
                    <div id="unassignedList"></div>
                </div>

                <div class="lobby-teams">
                    <div class="team-lobby team-left">
                        <h3 id="lobbyTeam1Name">TEAM 1</h3>
                        <div id="team1Slots">
                            <div class="player-slot empty">
                                <span class="player-name-lobby">Empty Slot 1</span>
                            </div>
                            <div class="player-slot empty">
                                <span class="player-name-lobby">Empty Slot 2</span>
                            </div>
                            <div class="player-slot empty">
                                <span class="player-name-lobby">Empty Slot 3</span>
                            </div>
                        </div>
                    </div>

                    <div class="team-lobby team-right">
                        <h3 id="lobbyTeam2Name">TEAM 2</h3>
                        <div id="team2Slots">
                            <div class="player-slot empty">
                                <span class="player-name-lobby">Empty Slot 4</span>
                            </div>
                            <div class="player-slot empty">
                                <span class="player-name-lobby">Empty Slot 5</span>
                            </div>
                            <div class="player-slot empty">
                                <span class="player-name-lobby">Empty Slot 6</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn-primary" id="startGameBtn">START GAME</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="game-screen" id="gameScreen">
            <div class="game-layout">
                <!-- Team Left -->
                <div class="team-section">
                    <div class="team-header team-left"><span id="gameTeam1Name">TEAM 1</span> - <span id="team1ScoreHeader">0</span></div>
                    <div class="video-container team-left">
                        <video id="video1" autoplay playsinline></video>
                        <div class="player-name" id="name1">Slot 1</div>
                        <div class="empty-label" id="empty1">WAITING FOR PLAYER</div>
                    </div>
                    <div class="video-container team-left">
                        <video id="video2" autoplay playsinline></video>
                        <div class="player-name" id="name2">Slot 2</div>
                        <div class="empty-label" id="empty2">WAITING FOR PLAYER</div>
                    </div>
                    <div class="video-container team-left">
                        <video id="video3" autoplay playsinline></video>
                        <div class="player-name" id="name3">Slot 3</div>
                        <div class="empty-label" id="empty3">WAITING FOR PLAYER</div>
                    </div>
                </div>

                <!-- Center - Host and Question Board -->
                <div class="center-section">
                    <div class="video-container host-video">
                        <video id="videoHost" autoplay playsinline muted></video>
                        <div class="player-name" id="nameHost">Host</div>
                    </div>
                    
                    <div class="question-board">
                        <div class="category-banner" id="categoryDisplay">WAITING TO START</div>
                        <div class="question-text" id="questionDisplay">Get ready for an epic trivia battle!</div>
                        <div class="timer" id="timerDisplay"></div>
                    </div>
                </div>

                <!-- Team Right -->
                <div class="team-section">
                    <div class="team-header team-right"><span id="gameTeam2Name">TEAM 2</span> - <span id="team2ScoreHeader">0</span></div>
                    <div class="video-container team-right">
                        <video id="video4" autoplay playsinline></video>
                        <div class="player-name" id="name4">Slot 4</div>
                        <div class="empty-label" id="empty4">WAITING FOR PLAYER</div>
                    </div>
                    <div class="video-container team-right">
                        <video id="video5" autoplay playsinline></video>
                        <div class="player-name" id="name5">Slot 5</div>
                        <div class="empty-label" id="empty5">WAITING FOR PLAYER</div>
                    </div>
                    <div class="video-container team-right">
                        <video id="video6" autoplay playsinline></video>
                        <div class="player-name" id="name6">Slot 6</div>
                        <div class="empty-label" id="empty6">WAITING FOR PLAYER</div>
                    </div>
                </div>
            </div>

            <!-- Host Controls -->
            <div class="host-controls" id="hostControls" style="display: none;">
                <h3>ðŸŽ® Host Controls</h3>
                
                <div class="input-group">
                    <label>Category</label>
                    <select id="categorySelect"></select>
                </div>

                <div class="input-group">
                    <label>Question</label>
                    <textarea id="questionInput" placeholder="Enter your trivia question here..."></textarea>
                </div>

                <div class="control-row">
                    <button class="btn-secondary btn-success" id="showQuestionBtn">Show Question</button>
                    <button class="btn-secondary" id="startTimerBtn">Start Timer (30s)</button>
                    <button class="btn-secondary" id="clearQuestionBtn">Clear Question</button>
                </div>

                <div class="control-row">
                    <button class="btn-secondary btn-success" id="team1PointBtn">Team 1 +1</button>
                    <button class="btn-secondary" id="team1MinusBtn">Team 1 -1</button>
                    <button class="btn-secondary btn-success" id="team2PointBtn">Team 2 +1</button>
                    <button class="btn-secondary" id="team2MinusBtn">Team 2 -1</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PeerJS Library -->
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>

    <script>
        // Create stars background
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            starsContainer.appendChild(star);
        }

        // Game Configuration
        let gameConfig = {
            hostName: '',
            team1Name: 'Team 1',
            team2Name: 'Team 2',
            numQuestions: 20,
            categories: []
        };

        // Game State
        let peer;
        let myStream;
        let connections = [];
        let playerData = {}; // { peerId: { name, team, stream, conn } }
        let isHost = false;
        let hostPeerId = '';
        let joinCodeToIdMap = {}; // Maps host names to peer IDs
        let gameState = {
            category: '',
            question: '',
            team1Score: 0,
            team2Score: 0,
            timerActive: false,
            timerValue: 30,
            teamAssignments: {} // { peerId: slotNumber }
        };

        // Check URL parameters for auto-join
        const urlParams = new URLSearchParams(window.location.search);
        const urlHostId = urlParams.get('host');
        const urlHostName = urlParams.get('name');

        if (urlHostId) {
            // Auto-fill from URL
            document.getElementById('playerBtn').click();
            if (urlHostName) {
                document.getElementById('hostJoinCode').value = urlHostName;
            }
        }

        // Role Selection
        document.getElementById('hostBtn').addEventListener('click', () => {
            document.getElementById('hostBtn').classList.add('active');
            document.getElementById('playerBtn').classList.remove('active');
            document.getElementById('hostSetup').style.display = 'block';
            document.getElementById('playerJoin').style.display = 'none';
            isHost = true;
        });

        document.getElementById('playerBtn').addEventListener('click', () => {
            document.getElementById('playerBtn').classList.add('active');
            document.getElementById('hostBtn').classList.remove('active');
            document.getElementById('hostSetup').style.display = 'none';
            document.getElementById('playerJoin').style.display = 'block';
            isHost = false;
        });

        // Category toggle
        function toggleCategory(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('selected');
        }

        // Create Game (Host)
        document.getElementById('createGameBtn').addEventListener('click', async () => {
            const hostName = document.getElementById('hostName').value.trim().toUpperCase();
            if (!hostName) {
                alert('Please enter your name!');
                return;
            }

            // Collect game config
            gameConfig.hostName = hostName;
            gameConfig.team1Name = document.getElementById('team1Name').value.trim() || 'Team 1';
            gameConfig.team2Name = document.getElementById('team2Name').value.trim() || 'Team 2';
            gameConfig.numQuestions = parseInt(document.getElementById('numQuestions').value) || 20;
            
            // Collect selected categories
            gameConfig.categories = [];
            document.querySelectorAll('.category-checkbox.selected label').forEach(label => {
                gameConfig.categories.push(label.textContent);
            });

            if (gameConfig.categories.length === 0) {
                alert('Please select at least one category!');
                return;
            }

            // Get user media
            try {
                myStream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: true 
                });
            } catch (err) {
                console.error('Error accessing media devices:', err);
                alert('Could not access camera/microphone. Please check permissions.');
                return;
            }

            // Initialize PeerJS
            peer = new Peer();

            peer.on('open', (id) => {
                hostPeerId = id;
                joinCodeToIdMap[hostName] = id;
                
                // Display join info
                document.getElementById('joinCodeDisplay').textContent = hostName;
                
                const shareLink = `${window.location.href.split('?')[0]}?host=${id}&name=${hostName}`;
                document.getElementById('shareLinkDisplay').textContent = shareLink;
                
                document.getElementById('hostJoinInfo').style.display = 'block';
                document.getElementById('createGameBtn').style.display = 'none';
                
                document.getElementById('nameHost').textContent = hostName;
            });

            peer.on('connection', (conn) => {
                handlePlayerConnection(conn);
            });

            peer.on('call', (call) => {
                call.answer(myStream);
                call.on('stream', (remoteStream) => {
                    const metadata = call.metadata;
                    if (metadata && metadata.peerId) {
                        if (!playerData[metadata.peerId]) {
                            playerData[metadata.peerId] = {};
                        }
                        playerData[metadata.peerId].stream = remoteStream;
                        playerData[metadata.peerId].name = metadata.playerName;
                    }
                });
            });
        });

        // Copy functions
        function copyJoinCode() {
            const code = document.getElementById('joinCodeDisplay').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const original = document.getElementById('joinCodeDisplay').textContent;
                document.getElementById('joinCodeDisplay').textContent = 'âœ“ COPIED!';
                setTimeout(() => {
                    document.getElementById('joinCodeDisplay').textContent = original;
                }, 2000);
            });
        }

        function copyShareLink() {
            const link = document.getElementById('shareLinkDisplay').textContent;
            navigator.clipboard.writeText(link).then(() => {
                const original = document.getElementById('shareLinkDisplay').textContent;
                document.getElementById('shareLinkDisplay').textContent = 'âœ“ COPIED!';
                setTimeout(() => {
                    document.getElementById('shareLinkDisplay').textContent = original;
                }, 2000);
            });
        }

        // Handle player connections (host side)
        function handlePlayerConnection(conn) {
            connections.push(conn);
            
            conn.on('open', () => {
                const metadata = conn.metadata;
                if (metadata) {
                    playerData[conn.peer] = {
                        name: metadata.playerName,
                        conn: conn,
                        team: null
                    };
                    
                    updatePlayerCount();
                    
                    // Send game config to player
                    conn.send({
                        type: 'gameConfig',
                        config: gameConfig
                    });
                }
            });

            conn.on('data', (data) => {
                handleMessage(data, conn.peer);
            });

            conn.on('close', () => {
                delete playerData[conn.peer];
                updatePlayerCount();
                updateLobby();
            });
        }

        function updatePlayerCount() {
            const count = Object.keys(playerData).length;
            document.getElementById('hostPlayerCount').textContent = `Players Connected: ${count}/6`;
        }

        // Join Game (Player)
        document.getElementById('joinGameBtn').addEventListener('click', async () => {
            const playerName = document.getElementById('playerName').value.trim();
            const joinCode = document.getElementById('hostJoinCode').value.trim().toUpperCase();
            
            if (!playerName) {
                alert('Please enter your name!');
                return;
            }
            
            if (!joinCode) {
                alert('Please enter the host\'s join code!');
                return;
            }

            // Get user media
            try {
                myStream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: true 
                });
            } catch (err) {
                console.error('Error accessing media devices:', err);
                alert('Could not access camera/microphone. Please check permissions.');
                return;
            }

            // Initialize PeerJS
            peer = new Peer();

            peer.on('open', (myId) => {
                // Connect to host using join code or URL parameter
                let targetHostId = urlHostId || null;
                
                // If no URL param, we need to resolve the join code
                // In a real implementation, you'd need a signaling server
                // For now, we'll try to connect directly if we have the ID from URL
                
                if (targetHostId) {
                    connectToHost(targetHostId, playerName, myId);
                } else {
                    alert('Direct join code lookup requires a signaling server. Please use the shareable link provided by the host!');
                }
            });

            peer.on('connection', (conn) => {
                conn.on('data', (data) => {
                    handleMessage(data);
                });
            });

            peer.on('call', (call) => {
                call.answer(myStream);
                call.on('stream', (remoteStream) => {
                    // This will be the host's stream or other players
                    if (call.metadata && call.metadata.role === 'host') {
                        document.getElementById('videoHost').srcObject = remoteStream;
                    }
                });
            });
        });

        function connectToHost(hostId, playerName, myId) {
            const conn = peer.connect(hostId, {
                metadata: { 
                    playerName: playerName,
                    peerId: myId
                }
            });
            
            conn.on('open', () => {
                connections.push(conn);
                
                // Make video call
                const call = peer.call(hostId, myStream, {
                    metadata: {
                        playerName: playerName,
                        peerId: myId
                    }
                });
                
                call.on('stream', (remoteStream) => {
                    document.getElementById('videoHost').srcObject = remoteStream;
                });

                // Listen for messages
                conn.on('data', (data) => {
                    handleMessage(data);
                });

                alert('Connected to host! Waiting for game to start...');
            });

            conn.on('error', (err) => {
                console.error('Connection error:', err);
                alert('Failed to connect to host. Please use the shareable link provided by the host.');
            });
        }

        // Go to Lobby
        document.getElementById('goToLobbyBtn').addEventListener('click', () => {
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('lobbyScreen').style.display = 'block';
            
            // Set team names in lobby
            document.getElementById('lobbyTeam1Name').textContent = gameConfig.team1Name.toUpperCase();
            document.getElementById('lobbyTeam2Name').textContent = gameConfig.team2Name.toUpperCase();
            
            // Set host video
            document.getElementById('videoHost').srcObject = myStream;
            
            updateLobby();
        });

        // Update Lobby
        function updateLobby() {
            const unassignedList = document.getElementById('unassignedList');
            unassignedList.innerHTML = '';
            
            // Show unassigned players
            Object.keys(playerData).forEach(peerId => {
                const player = playerData[peerId];
                if (!gameState.teamAssignments[peerId]) {
                    const slot = document.createElement('div');
                    slot.className = 'player-slot filled';
                    slot.innerHTML = `
                        <span class="player-name-lobby">${player.name}</span>
                        <div>
                            <button class="move-btn" onclick="assignToTeam('${peerId}', 1)">â†’ Team 1</button>
                            <button class="move-btn" onclick="assignToTeam('${peerId}', 2)">â†’ Team 2</button>
                        </div>
                    `;
                    unassignedList.appendChild(slot);
                }
            });
            
            if (unassignedList.children.length === 0) {
                unassignedList.innerHTML = '<p style="text-align: center; color: var(--text-dim);">All players assigned!</p>';
            }
            
            // Update team slots
            updateTeamSlots();
        }

        function assignToTeam(peerId, team) {
            // Find next available slot for team
            let slotNumber = null;
            const startSlot = team === 1 ? 1 : 4;
            const endSlot = team === 1 ? 3 : 6;
            
            for (let i = startSlot; i <= endSlot; i++) {
                if (!Object.values(gameState.teamAssignments).includes(i)) {
                    slotNumber = i;
                    break;
                }
            }
            
            if (slotNumber) {
                gameState.teamAssignments[peerId] = slotNumber;
                playerData[peerId].team = team;
                updateLobby();
                broadcastMessage({ type: 'teamAssignment', assignments: gameState.teamAssignments });
            } else {
                alert(`Team ${team} is full!`);
            }
        }

        function removeFromTeam(peerId) {
            delete gameState.teamAssignments[peerId];
            playerData[peerId].team = null;
            updateLobby();
            broadcastMessage({ type: 'teamAssignment', assignments: gameState.teamAssignments });
        }

        function updateTeamSlots() {
            // Team 1 slots
            for (let i = 1; i <= 3; i++) {
                const slotDiv = document.getElementById('team1Slots').children[i-1];
                const peerId = Object.keys(gameState.teamAssignments).find(id => gameState.teamAssignments[id] === i);
                
                if (peerId && playerData[peerId]) {
                    slotDiv.className = 'player-slot filled';
                    slotDiv.innerHTML = `
                        <span class="player-name-lobby">${playerData[peerId].name}</span>
                        <button class="move-btn" onclick="removeFromTeam('${peerId}')">Remove</button>
                    `;
                } else {
                    slotDiv.className = 'player-slot empty';
                    slotDiv.innerHTML = `<span class="player-name-lobby">Empty Slot ${i}</span>`;
                }
            }
            
            // Team 2 slots
            for (let i = 4; i <= 6; i++) {
                const slotDiv = document.getElementById('team2Slots').children[i-4];
                const peerId = Object.keys(gameState.teamAssignments).find(id => gameState.teamAssignments[id] === i);
                
                if (peerId && playerData[peerId]) {
                    slotDiv.className = 'player-slot filled';
                    slotDiv.innerHTML = `
                        <span class="player-name-lobby">${playerData[peerId].name}</span>
                        <button class="move-btn" onclick="removeFromTeam('${peerId}')">Remove</button>
                    `;
                } else {
                    slotDiv.className = 'player-slot empty';
                    slotDiv.innerHTML = `<span class="player-name-lobby">Empty Slot ${i}</span>`;
                }
            }
        }

        // Start Game
        document.getElementById('startGameBtn').addEventListener('click', () => {
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('hostControls').style.display = 'block';
            
            // Set team names
            document.getElementById('gameTeam1Name').textContent = gameConfig.team1Name.toUpperCase();
            document.getElementById('gameTeam2Name').textContent = gameConfig.team2Name.toUpperCase();
            
            // Populate category dropdown
            const categorySelect = document.getElementById('categorySelect');
            gameConfig.categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });
            
            // Place player videos
            Object.keys(gameState.teamAssignments).forEach(peerId => {
                const slotNumber = gameState.teamAssignments[peerId];
                const player = playerData[peerId];
                
                if (player && player.stream) {
                    const video = document.getElementById(`video${slotNumber}`);
                    const nameLabel = document.getElementById(`name${slotNumber}`);
                    const emptyLabel = document.getElementById(`empty${slotNumber}`);
                    
                    video.srcObject = player.stream;
                    nameLabel.textContent = player.name;
                    emptyLabel.style.display = 'none';
                    video.parentElement.classList.remove('empty');
                }
            });
            
            setupHostControls();
            broadcastMessage({ type: 'startGame', config: gameConfig, assignments: gameState.teamAssignments });
        });

        // Message Handler
        function handleMessage(data, fromPeerId) {
            if (data.type === 'gameConfig') {
                gameConfig = data.config;
            } else if (data.type === 'startGame') {
                // Player side - transition to game
                document.getElementById('setupScreen').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'block';
                
                gameConfig = data.config;
                gameState.teamAssignments = data.assignments;
                
                document.getElementById('gameTeam1Name').textContent = gameConfig.team1Name.toUpperCase();
                document.getElementById('gameTeam2Name').textContent = gameConfig.team2Name.toUpperCase();
            } else if (data.type === 'gameState') {
                updateGameState(data.state);
            } else if (data.type === 'teamAssignment') {
                gameState.teamAssignments = data.assignments;
            }
        }

        // Host Controls
        function setupHostControls() {
            document.getElementById('showQuestionBtn').addEventListener('click', () => {
                const category = document.getElementById('categorySelect').value;
                const question = document.getElementById('questionInput').value.trim();
                
                if (category && question) {
                    gameState.category = category;
                    gameState.question = question;
                    updateLocalDisplay();
                    broadcastGameState();
                }
            });

            document.getElementById('clearQuestionBtn').addEventListener('click', () => {
                gameState.category = 'WAITING FOR NEXT QUESTION';
                gameState.question = '';
                gameState.timerActive = false;
                updateLocalDisplay();
                broadcastGameState();
            });

            document.getElementById('startTimerBtn').addEventListener('click', () => {
                startTimer();
            });

            document.getElementById('team1PointBtn').addEventListener('click', () => {
                gameState.team1Score++;
                updateLocalDisplay();
                broadcastGameState();
            });

            document.getElementById('team1MinusBtn').addEventListener('click', () => {
                gameState.team1Score = Math.max(0, gameState.team1Score - 1);
                updateLocalDisplay();
                broadcastGameState();
            });

            document.getElementById('team2PointBtn').addEventListener('click', () => {
                gameState.team2Score++;
                updateLocalDisplay();
                broadcastGameState();
            });

            document.getElementById('team2MinusBtn').addEventListener('click', () => {
                gameState.team2Score = Math.max(0, gameState.team2Score - 1);
                updateLocalDisplay();
                broadcastGameState();
            });
        }

        function updateLocalDisplay() {
            document.getElementById('categoryDisplay').textContent = gameState.category || 'WAITING TO START';
            document.getElementById('questionDisplay').textContent = gameState.question || 'Get ready for an epic trivia battle!';
            document.getElementById('team1ScoreHeader').textContent = gameState.team1Score;
            document.getElementById('team2ScoreHeader').textContent = gameState.team2Score;
            
            if (gameState.timerActive) {
                document.getElementById('timerDisplay').textContent = gameState.timerValue;
            } else {
                document.getElementById('timerDisplay').textContent = '';
            }
        }

        function updateGameState(state) {
            gameState = state;
            updateLocalDisplay();
        }

        function broadcastGameState() {
            broadcastMessage({
                type: 'gameState',
                state: gameState
            });
        }

        function broadcastMessage(message) {
            connections.forEach(conn => {
                if (conn.open) {
                    conn.send(message);
                }
            });
        }

        function startTimer() {
            gameState.timerValue = 30;
            gameState.timerActive = true;
            updateLocalDisplay();
            broadcastGameState();

            const timerInterval = setInterval(() => {
                gameState.timerValue--;
                updateLocalDisplay();
                broadcastGameState();

                if (gameState.timerValue <= 0) {
                    clearInterval(timerInterval);
                    gameState.timerActive = false;
                    updateLocalDisplay();
                    broadcastGameState();
                }
            }, 1000);
        }

        // Mark empty video containers
        for (let i = 1; i <= 6; i++) {
            document.getElementById(`video${i}`).parentElement.classList.add('empty');
        }
    </script>
</body>
</html>
